!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Boid=e()}(this,function(){"use strict";function t(t,e){Object.keys(e).forEach(function(n){"undefined"==typeof t[n]&&(t[n]=e[n])})}function e(e){return e=e||{},e.bounds=e.bounds||{},t(e,y),t(e.bounds,y.bounds),e}function n(t){function i(t,e,n,i){return D.width=t,D.height=e,D.x=n||0,D.y=i||0,m}function r(){var t=D.x+D.width;b.x>t?(b.x=t,B.x*=-1):b.x<D.x&&(b.x=D.x,B.x*=-1);var e=D.y+D.height;b.y>e?(b.y=e,B.y*=-1):b.y<D.y&&(b.y=D.y,B.y*=-1)}function o(){var t=D.x+D.width;b.x>t?b.x=D.x:b.x<D.x&&(b.x=t);var e=D.y+D.height;b.y>e?b.y=D.y:b.y<D.y&&(b.y=e)}function s(t){var e=t.clone().subtract(b);e.normalize(),e.scaleBy(E);var n=e.subtract(B);return w.add(n),n.dispose(),m}function u(t){var e=t.clone().subtract(b);e.normalize(),e.scaleBy(E);var n=e.subtract(B);return w.subtract(n),n.dispose(),m}function a(t){var e=t.clone().subtract(b);e.normalize();var n=b.distanceSq(t);if(n>k)e.scaleBy(E);else{var i=E*n/k;e.scaleBy(i)}var r=e.subtract(B);return w.add(r),r.dispose(),m}function c(t){var e=b.distanceSq(t.position)/z,n=t.velocity.clone().scaleBy(e),i=t.position.clone().add(n);return s(i),n.dispose(),i.dispose(),m}function d(t){var e=b.distanceSq(t.position)/z,n=t.velocity.clone().scaleBy(e),i=t.position.clone().add(n);return u(i),n.dispose(),i.dispose(),m}function y(){var t=B.clone().normalize().scaleBy(M),e=h.get();e.set(O,N),O+=Math.random()*T-.5*T;var n=t.add(e);return w.add(n),e.dispose(),n.dispose(),m}function l(t){for(var e=0;e<t.length;e++){var n=t[e],i=B.clone().normalize(),r=n.position.clone().subtract(b),o=r.dotProduct(i);if(o>0){var s=i.clone().scaleBy(j),u=i.clone().scaleBy(o),a=u.subtract(r),c=a.length;if(c<(n.radius||0)+G&&u.length<s.length){var d=i.clone().scaleBy(E);d.angle+=r.sign(B)*f;var h=u.length/s.length;d.scaleBy(1-h),w.add(d),B.scaleBy(h),d.dispose()}s.dispose(),u.dispose(),a.dispose()}i.dispose(),r.dispose()}return m}function p(t,e){e=!!e;var n=t[_];return n?(b.distanceSq(n)<C&&(_>=t.length-1?e&&(_=0):_++),_>=t.length-1&&!e?a(n):s(n),m):(_=0,m)}function g(t){if(b.distanceSq(t.position)>I)return!1;var e=B.clone().normalize(),n=t.position.clone().subtract(b),i=n.dotProduct(e);return e.dispose(),n.dispose(),i>=0}function x(t){for(var e=B.clone(),n=h.get(),i=0,r=0;r<t.length;r++){var o=t[r];o!==m&&g(o)&&(e.add(o.velocity),n.add(o.position),b.distanceSq(o.position)<W&&u(o.position),i++)}return i>0&&(e.divideBy(i),n.divideBy(i),s(n),w.add(e.subtract(B))),e.dispose(),n.dispose(),m}function v(){return w.truncate(P),1!==q&&w.divideBy(q),B.x+=w.x,B.y+=w.y,w.x=0,w.y=0,B.truncate(E),b.x+=B.x,b.y+=B.y,S===n.EDGE_BOUNCE?r():S===n.EDGE_WRAP&&o(),m}t=e(t);var m=null,b=h.get(),B=h.get(),w=h.get(),D=t.bounds,S=t.edgeBehavior,q=t.mass,E=t.maxSpeed,z=E*E,P=t.maxForce,R=t.arriveThreshold,k=R*R,M=t.wanderDistance,N=t.wanderRadius,O=t.wanderAngle,T=t.wanderRange,j=t.avoidDistance,G=t.avoidBuffer,_=0,A=t.pathThreshold,C=A*A,F=t.maxDistance,I=F*F,U=t.minDistance,W=U*U;return m={bounds:D,setBounds:i,update:v,pursue:c,evade:d,wander:y,avoid:l,followPath:p,flock:x,arrive:a,seek:s,flee:u,position:b,velocity:B,userData:{}},Object.defineProperties(m,{edgeBehavior:{get:function(){return S},set:function(t){S=t}},mass:{get:function(){return q},set:function(t){q=t}},maxSpeed:{get:function(){return E},set:function(t){E=t,z=t*t}},maxForce:{get:function(){return P},set:function(t){P=t}},arriveThreshold:{get:function(){return R},set:function(t){R=t,k=t*t}},wanderDistance:{get:function(){return M},set:function(t){M=t}},wanderRadius:{get:function(){return N},set:function(t){N=t}},wanderRange:{get:function(){return T},set:function(t){T=t}},avoidDistance:{get:function(){return j},set:function(t){j=t}},avoidBuffer:{get:function(){return G},set:function(t){G=t}},pathIndex:{get:function(){return _},set:function(t){_=t}},pathThreshold:{get:function(){return A},set:function(t){A=t,C=t*t}},maxDistance:{get:function(){return F},set:function(t){F=t,I=t*t}},minDistance:{get:function(){return U},set:function(t){U=t,W=t*t}}}),Object.freeze(m)}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=Math.acos,s=Math.atan2,u=Math.cos,a=Math.sin,c=Math.sqrt,d=[],h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.x=e,this.y=n}return t.prototype.add=function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this},t.prototype.subtract=function(t){return this.x=this.x-t.x,this.y=this.y-t.y,this},t.prototype.normalize=function(){var t=this.lengthSquared;if(0===t)return this.x=1,this;if(1===t)return this;var e=c(t);return this.x/=e,this.y/=e,this},t.prototype.isNormalized=function(){return 1===this.lengthSquared},t.prototype.truncate=function(t){return this.lengthSquared>t*t&&(this.length=t),this},t.prototype.scaleBy=function(t){return this.x*=t,this.y*=t,this},t.prototype.divideBy=function(t){return this.x/=t,this.y/=t,this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.distanceSq=function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},t.prototype.distance=function(t){return c(this.distanceSq(t))},t.prototype.clone=function(){return t.get(this.x,this.y)},t.prototype.reset=function(){return this.x=0,this.y=0,this},t.prototype.perpendicular=function(){return t.get(-this.y,this.x)},t.prototype.sign=function(t){var e=this.perpendicular(),n=e.dotProduct(t)<0?-1:1;return e.dispose(),n},t.prototype.set=function(t,e){return this.x=u(t)*e,this.y=a(t)*e,this},t.prototype.dispose=function(){this.x=0,this.y=0,d.push(this)},t.get=function(e,n){var i=d.length>0?d.pop():new t;return i.x=e||0,i.y=n||0,i},t.fill=function(e){for(;d.length<e;)d.push(new t)},t.angleBetween=function(t,e){return t.isNormalized()||(t=t.clone().normalize()),e.isNormalized()||(e=e.clone().normalize()),o(t.dotProduct(e))},r(t,[{key:"lengthSquared",get:function(){return this.x*this.x+this.y*this.y}},{key:"length",get:function(){return c(this.lengthSquared)},set:function(t){var e=this.angle;this.x=u(e)*t,this.y=a(e)*t}},{key:"angle",get:function(){return s(this.y,this.x)},set:function(t){var e=this.length;this.x=u(t)*e,this.y=a(t)*e}}]),t}(),f=Math.PI/2,y={bounds:{x:0,y:0,width:640,height:480},edgeBehavior:"bounce",mass:1,maxSpeed:10,maxForce:1,arriveThreshold:50,wanderDistance:10,wanderRadius:5,wanderAngle:0,wanderRange:1,avoidDistance:300,avoidBuffer:20,pathThreshold:20,maxDistance:300,minDistance:60};return n.EDGE_NONE="none",n.EDGE_BOUNCE="bounce",n.EDGE_WRAP="wrap",n.Vec2=h,n.vec2=function(t,e){return h.get(t,e)},n.obstacle=function(t,e,n){return{radius:t,position:h.get(e,n)}},n});
